<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gesture - Making gesture recognition as easy as a wave of your hand.</title>
    <link rel="stylesheet" type="text/css" href="css/components.css">
    <link rel="stylesheet" type="text/css" href="css/icons.css">
    <link rel="stylesheet" type="text/css" href="css/responsee.css">
    <link rel="stylesheet" type="text/css" href="owl-carousel/owl.carousel.css">
    <link rel="stylesheet" type="text/css" href="owl-carousel/owl.theme.css">
    <link rel="stylesheet" type="text/css" href="css/lightcase.css">
    <!-- CUSTOM STYLE -->      
    <link rel="stylesheet" href="css/template-style.css">
    <link href="https://fonts.googleapis.com/css?family=Work+Sans:100,400,600,900&subset=latin-ext" rel="stylesheet"> 
    <script type="text/javascript" src="js/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui.min.js"></script>
    <meta charset="utf-8">
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.1/full/pyodide.js"></script>
    <script type="module" src="https://pyscript.net/releases/2024.3.2/core.js"></script>
    <py-config type="json" src="/media_pipe/gesture/pyscript-config.json"></py-config>
    <script type="py" src="/media_pipe/gesture/base.py"></script>
  
  </head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-GJ1F1KKQDF"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-GJ1F1KKQDF');
  </script>

  <body class="size-1140">
    <div id="page-wrapper">
      <!-- HEADER -->
      <header role="banner" class="position-absolute margin-top-30 margin-m-top-0 margin-s-top-0">    
        <!-- Top Navigation -->
        <nav class="background-transparent background-transparent-hightlight full-width sticky">
          <div class="s-8 l-2">
            <a href="index.html" class="logo">
              <!-- Logo version before sticky nav -->
              <img class="logo-before" src="img/logo-dark.png" alt="">
              <!-- Logo version after sticky nav -->
              <img class="logo-after" src="img/logo-dark.png" alt="">
            </a>
          </div>
          <div class="s-4 l-10">
            <div class="top-nav right">
              <p class="nav-text"></p>
              <ul class="right chevron">
                <li><a href="index.html">Home</a></li>
                <li><a href="about-us.html">About Us</a></li>             
                <li><a href="contact.html">Contact</a></li>
              </ul>
            </div>
          </div>  
        </nav>
      </header>
      
      <!-- MAIN -->
      <main role="main">
        <!-- Content -->
        <article>
          <!-- <header class="section background-white">
            <div class="line text-center">        
              <h1 class="text-dark text-s-size-30 text-m-size-40 text-l-size-headline text-thin text-line-height-1">Gesture Recognition Technology is the Future.</h1>
              <p class="margin-bottom-0 text-size-16 text-dark">
              Try experimenting below with gesture recognition.<br>
              Below is a proof of concept of what we are creating. It can recognize poses, and teach you the sign language number system, 1 through 10.<br>
              So start interacting and learning sign language today!<br>
            </p>

            </div>
          </header> -->
          <div id="demo">
            <div class="container">
              <div class="hide-l hide-xl sm-12"> 
                <!-- TODO: Change to loading when libraries have not started... -->
                <button type="button" id="button" name="myButton">Start Your Camera<br />and<br />Start Learning ASL</button>
              </div>
              <div id="gesture_display" class="sm-12 m-4 l-2" style="background-color: grey; font-size: 3em; opacity: 0.5; margin: 50px; font-family: 'Inter,sans-serif'; position: absolute;">
                <div id="gesture-guide-title" style="opacity: 1;">Make the <span id="gesture-guide-name">0</span> Gesture</div>
                <!-- <div id="gesture-guide-percent" style="opacity: 1;"><span id="gesture-guide-percent">0</span>%</div> -->
                <div style="opacity: 1;"><img id="gesture-guide-image" src="img/asl-poses/ASL-Alphabet-0.png" alt="" style="width: 100%;"/></div>
              </div>
              <video style="display: none" class="input_video"></video>
              <!-- TODO: Make full screen -->
              <canvas class="output_canvas" style="display: block; width: 100%"></canvas>
            </div>
          </div>
          <div class="background-white full-width">
            <div class="s-12 m-6 l-five">
              <a class="image-with-hover-overlay image-hover-zoom" href="/asl-poc.html" title="Portfolio Image">
                <div class="image-hover-overlay background-primary"> 
                  <div class="image-hover-overlay-content text-center padding-2x">
                    <h3 class="text-white text-size-20 margin-bottom-10">Sign Language Learning Application</h3>
                    <p class="text-white text-size-14 margin-bottom-20">Learn the sign language alphabet anywhere, anytime!</p>
                  </div> 
                </div> 
                <img class="full-img" src="img/ASL-Blur.png" alt=""/>
              </a>	
            </div>
            <div class="s-12 m-6 l-five">
              <a class="image-with-hover-overlay image-hover-zoom" href="/asl-a-z?asl_chars=ABCDEF" title="Portfolio Image">
                <div class="image-hover-overlay background-primary"> 
                  <div class="image-hover-overlay-content text-center padding-2x">
                    <h3 class="text-white text-size-20 margin-bottom-10">Sign Language Learning Application</h3>
                    <p class="text-white text-size-14 margin-bottom-20">Learn the sign language alphabet A - F!</p>
                  </div> 
                </div> 
                <img class="full-img" src="img/ABC.png" alt="ABC ASL"/>
              </a>	
            </div>
            <div class="s-12 m-6 l-five">
              <a class="image-with-hover-overlay image-hover-zoom" href="/asl-a-z?asl_chars=0123456789" title="Portfolio Image">
                <div class="image-hover-overlay background-primary">
                  <div class="image-hover-overlay-content text-center padding-2x">
                    <h3 class="text-white text-size-20 margin-bottom-10">Sign Language Learning Application</h3>
                    <p class="text-white text-size-14 margin-bottom-20">Learn the sign language alphabet 0 - 9!</p>
                  </div> 
                </div> 
                <img class="full-img" src="img/0-9.png" alt="0123456789 ASL"/>
              </a>	
            </div>
            <div class="s-12 m-6 l-five">
              <a class="image-with-hover-overlay image-hover-zoom" href="/" title="Portfolio Image">
                <div class="image-hover-overlay background-primary"> 
                  <div class="image-hover-overlay-content text-center padding-2x">
                    <h3 class="text-white text-size-20 margin-bottom-10">Exercise Application</h3>
                    <p class="text-white text-size-14 margin-bottom-20">Go through a yoga flow. Remotely!</p>                  
                  </div> 
                </div> 
                <img class="full-img" src="img/under_construction.png" alt=""/>
              </a>	
            </div>
          </div>  
        </article>
      </main>
      
      <!-- FOOTER -->
      <footer>
        <!-- Contact Us -->
        <div class="background-dark padding text-center footer-social">
          <a class="margin-right-10" target="_blank" href="https://www.facebook.com"><i class="icon-facebook_circle text-size-30"></i> <span class="text-strong text-white hide-s hide-m">FACEBOOK</span></a>
          <a class="margin-right-10" target="_blank" href="https://www.twitter.com"><i class="icon-twitter_circle text-size-30"></i> <span class="text-strong text-white hide-s hide-m">TWITTER</span></a>
          <a class="margin-right-10" target="_blank" href="https://www.instagram.com"><i class="icon-instagram_circle text-size-30"></i> <span class="text-strong text-white hide-s hide-m">INSTAGRAM</span></a>
          <a target="_blank" href="https://www.linkedin.com"><i class="icon-linked_in_circle text-size-30"></i> <span class="text-strong text-white hide-s hide-m">LINKEDIN</span></a>                                                                         
        </div>

        <!-- Main Footer -->
        <section class="section-small-padding text-center background-dark full-width">
          <div class="line">
            <div class="margin">
              <!-- Collumn 1 -->              
              <div class="s-12 m-12 l-4 margin-m-bottom-30">
                <h3 class="text-size-16">222 W Merchandise Mart Plaza</h3>
                <p class="text-size-14">
                  #1212<br>
                  Chicago, IL<br> 
                  60654
                </p>               
              </div>
              <!-- Collumn 2 -->
              <div class="s-12 m-12 l-4 margin-m-bottom-30">
                <h3 class="text-size-16">E-mail</h3>
                <p class="text-size-14">
                   jimmy@gesture.world<br>
                   bella@gesture.world
                </p>              
              </div>
              <!-- Collumn 3 -->
              <div class="s-12 m-12 l-4 ">
                <h3 class="text-size-16">Phone Numbers</h3>
                <p class="text-size-14">
                   415 455 6951<br>
                </p>             
              </div>
            </div>
          </div>  
        </section>
        <hr class="break margin-top-bottom-0" style="border-color: rgba(0, 0, 0, 0.80);">
        
        <!-- Bottom Footer -->
        <section class="padding background-dark full-width">
          <div class="text-center">
            <p class="text-size-12"></p>
            <p class="text-size-12"></p>
          </div>
        </section>
      </footer>
    </div>
    <script type="text/javascript" src="js/responsee.js"></script>
    <script type="text/javascript" src="js/jquery.events.touch.js"></script>
    <script type="text/javascript" src="owl-carousel/owl.carousel.js"></script>
    <script type="text/javascript" src="js/template-scripts.js"></script> 
    <script type="text/javascript">
      const module = {};
    </script>
    <script type="module">
    
      // TODO: move into it's own script.
      var query = window.location.search.substring(1);
      var qs = parse_query_string(query);
      
      var char_pointer = 0;
      var cur_char = qs.asl_chars[char_pointer]
      
      changeChar(cur_char, 0);
      
      let canvasElement = document.getElementsByClassName('output_canvas')[0];
      const canvasCtx = canvasElement.getContext('2d');
      
      
      // Commented out b/c we are making this better.
      if(mobileCheck() == false)
        startCamera();
      
      //required for mobile..
      window.addEventListener('load', function () {
        document.getElementById('button').onclick = function(){
          startCamera();
          
          //const stream = navigator.mediaDevices.getUserMedia({video: true});
          //const {width, height} = stream.getVideoTracks()[0].getSettings();
          //canvasElement.width = window.innerWidth;
          //canvasElement.height = window.innerHeight;
        };
      });

      function startCamera(){
        // TODO: Figure out if these values are correct for mobile compliance.
        const videoElement = document.getElementsByClassName('input_video')[0];
        const camera = new Camera(videoElement, {
          onFrame: async () => {
            await hands.send({image: videoElement});
          },
          width: 1280,
          height: 720
        });
        camera.start();
      }
      function onResults(results) {


        // Omg this is so effing baddd.... We need to have this load on page load..s
        
        
        canvasCtx.save();
        canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
        canvasCtx.drawImage(results.image, 0, 0, canvasElement.width, canvasElement.height);
        
        if (results.multiHandLandmarks) {
          for (const landmarks of results.multiHandLandmarks) {
            drawConnectors(canvasCtx, landmarks, HAND_CONNECTIONS,
                           {color: '#00FF00', lineWidth: 5});
            drawLandmarks(canvasCtx, landmarks, {color: '#FF0000', lineWidth: 2});
    
            let ar = []
            let ar2 = []
            let ar3 = []
            
            // TODO: Simplify.
            if(results.multiHandLandmarks[0] != undefined)
              for( var i = 0; i < results.multiHandLandmarks[0].length; i++){
                let x = results.multiHandLandmarks[0][i].x
                let y = results.multiHandLandmarks[0][i].y
                let z = results.multiHandLandmarks[0][i].z
                ar.push([x,y,z])
              }
            if(results.multiHandLandmarks[1] != undefined)
              for( var i = 0; i < results.multiHandLandmarks[1].length; i++){
                let x = results.multiHandLandmarks[1][i].x
                let y = results.multiHandLandmarks[1][i].y
                let z = results.multiHandLandmarks[1][i].z
                ar2.push([x,y,z])
              }
            if(results.multiHandLandmarks[2] != undefined)
              for( var i = 0; i < results.multiHandLandmarks[2].length; i++){
                let x = results.multiHandLandmarks[2][i].x
                let y = results.multiHandLandmarks[2][i].y
                let z = results.multiHandLandmarks[2][i].z
                ar3.push([x,y,z])
              }
            
            if(window.gesture != undefined){
              
              // TODO: Change to only execute once..
              window.gesture.set_base_path_web();

              let gesture_reconition_output = window.gesture.predict({
                "right": JSON.stringify(ar),
                "left": JSON.stringify(ar2),
                "body": JSON.stringify(ar3)
              })
              
              if(isLikeGesture(window.static_gesture, cur_char)){
                char_pointer = ( char_pointer + 1 ) % qs.asl_chars.length;
                cur_char = qs.asl_chars[char_pointer]
                changeChar(cur_char, true)
              }
            }
          }
        }
        canvasCtx.restore();
      }
      
      const hands = new Hands({locateFile: (file) => {
        return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
      }});
      hands.setOptions({
        maxNumHands: 1,
        modelComplexity: 1,
        minDetectionConfidence: 0.5,
        minTrackingConfidence: 0.5
      });
      hands.onResults(onResults);
      
      function changeChar(cur_char, percent){
        window.cur_char = cur_char;
        document.getElementById("gesture-guide-name").innerHTML = cur_char;
        //document.getElementById("gesture-guide-percent").innerHTML = percent;
        document.getElementById("gesture-guide-image").setAttribute("src", "img/asl-poses/ASL-Alphabet-" + cur_char + ".png");
      }

      function parse_query_string(query) {
        var vars = query.split("&");
        var query_string = {};
        for (var i = 0; i < vars.length; i++) {
          var pair = vars[i].split("=");
          var key = decodeURIComponent(pair.shift());
          var value = decodeURIComponent(pair.join("="));
          // If first entry with this name
          if (typeof query_string[key] === "undefined") {
            query_string[key] = value;
            // If second entry with this name
          } else if (typeof query_string[key] === "string") {
            var arr = [query_string[key], value];
            query_string[key] = arr;
            // If third or later entry with this name
          } else {
            query_string[key].push(value);
          }
        }
        return query_string;
      }

      // We need a different type of comparison for a few edge cases... 
      // because some gestures are similar to others.
      function isLikeGesture(a, b){
        if(a == b)
          return true;
        // start with the numbers.
        console.log(a,b)
        if((a == 'O' || a == 'zero' || a === 0) && (b === "0") ){
          return true;
        }
        if((a == "D" || a == 'one' || a == 'one_inv') && (b === "1" || b == "D") ){
          return true;
        }
        if((a == "V" || a == 'two' || a == 'two_inv' || a == 2 ) && (b == 2 || b == "V")){
          return true;
        }
        if((a == 'three' || a == 'three_inv' || a == 3) && (b == 3) ){
          return true;
        }
        if((a == "B" || a == 'four' || a == 'four_inv' || a == 4 )&& (b == 4 || b == "B")){
          return true;
        }
        if((a == 'five'  || a == 'five_inv' || a == 5) && (b == 5) ){
          return true;
        }
        if((a == 'six' || a == 6) && (b == 6) ){
          return true;
        }
        if((a == 'seven' || a == 7 )&& (b == 7) ){
          return true;
        }
        if((a == 'eight' || a == 8) && (b == 8) ){
          return true;
        }
        if((a == 'nine' || a == 'F' || a == 9) && (b == 9 || b == "F") ){
          return true;
        }

        // This model needs some help.
        if(a == 'Q' && b == 'G')
          return true;

        return false;

      }
      function mobileCheck() {
        let check = false;
        (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
        return check;
      };
      </script>
  </body>
</html>
<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gesture - Making gesture recognition as easy as a wave of your hand.</title>
    <link rel="stylesheet" type="text/css" href="css/components.css">
    <link rel="stylesheet" type="text/css" href="css/icons.css">
    <link rel="stylesheet" type="text/css" href="css/gesture-responsee.css">
    <link rel="stylesheet" type="text/css" href="owl-carousel/owl.carousel.css">
    <link rel="stylesheet" type="text/css" href="owl-carousel/owl.theme.css">
    <link rel="stylesheet" type="text/css" href="css/lightcase.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="stylesheet" type="text/css" href="css/nav-styles.css">
    <link rel="stylesheet" type="text/css" href="css/main-styles.css">
    <link rel="stylesheet" type="text/css" href="css/core-styles.css">
    <link rel="stylesheet" type="text/css" href="css/footer-styles.css">
    <!-- CUSTOM STYLE -->      
    <link rel="stylesheet" href="css/template-style.css">
    <link href="https://fonts.googleapis.com/css?family=Work+Sans:100,400,600,900&subset=latin-ext" rel="stylesheet"> 
    <script type="text/javascript" src="js/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui.min.js"></script>
    <meta charset="utf-8">
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.1/full/pyodide.js"></script>
    <script type="module" src="https://pyscript.net/releases/2024.3.2/core.js"></script>
    <py-config type="json" src="/media_pipe/gesture/pyscript-config.json"></py-config>
    <script type="py" src="/media_pipe/gesture/base.py"></script>
  
  </head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-GJ1F1KKQDF"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-GJ1F1KKQDF');
  </script>

  <body class="size-1140">
    <!-- ============================================ -->
    <!--                 Navigation                   -->
    <!-- ============================================ -->
  
    <header id="cs-navigation">
      <div class="cs-container">
          <!--Nav Logo-->
          <a href="" class="cs-logo" aria-label="back to home">
              <img src="img/Gesture-G-Hand-Logo-With-Text.png" alt="logo" width="210" height="29" aria-hidden="true" decoding="async">
          </a>
          <!--Navigation List-->
          <nav class="cs-nav" role="navigation">
              <!--Mobile Nav Toggle-->
              <button class="cs-toggle" aria-label="mobile menu toggle">
                  <div class="cs-box" aria-hidden="true">
                      <span class="cs-line cs-line1" aria-hidden="true"></span>
                      <span class="cs-line cs-line2" aria-hidden="true"></span>
                      <span class="cs-line cs-line3" aria-hidden="true"></span>
                  </div>
              </button>
              <!-- We need a wrapper div so we can set a fixed height on the cs-ul in case the nav list gets too long from too many dropdowns being opened and needs to have an overflow scroll. This wrapper acts as the background so it can go the full height of the screen and not cut off any overflowing nav items while the cs-ul stops short of the bottom of the screen, which keeps all nav items in view no matter how mnay there are-->
              <div class="cs-ul-wrapper">
                  <ul id="cs-expanded" class="cs-ul" aria-expanded="false">
                      <li class="cs-li">
                          <a href="#hero-1619" class="cs-li-link cs-active">
                              Home
                          </a>
                      </li>
                      <li class="cs-li">
                          <a href="#steps-889" class="cs-li-link">
                              Our Process
                          </a>
                      </li>
                      <li class="cs-li">
                          <a href="#services-1724" class="cs-li-link">
                              About Us
                          </a>
                      </li>
                      <li class="cs-li">
                          <a href="#services-1267" class="cs-li-link">
                              Statistics
                          </a>
                      </li>
                      <li class="cs-li">
                          <a href="#sbsr-1575" class="cs-li-link">
                              FAQ
                          </a>
                      </li>
                  </ul>
              </div>
          </nav>
          <a href="#contact-984" class="cs-button-solid cs-nav-button">Contact Us</a>
          <!--Dark Mode toggle, uncomment button code if you want to enable a dark mode toggle-->
          <!-- <button id="dark-mode-toggle" aria-label="dark mode toggle">
              <svg class="cs-moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 480" style="enable-background:new 0 0 480 480" xml:space="preserve"><path d="M459.782 347.328c-4.288-5.28-11.488-7.232-17.824-4.96-17.76 6.368-37.024 9.632-57.312 9.632-97.056 0-176-78.976-176-176 0-58.4 28.832-112.768 77.12-145.472 5.472-3.712 8.096-10.4 6.624-16.832S285.638 2.4 279.078 1.44C271.59.352 264.134 0 256.646 0c-132.352 0-240 107.648-240 240s107.648 240 240 240c84 0 160.416-42.688 204.352-114.176 3.552-5.792 3.04-13.184-1.216-18.496z"/></svg>
              <img class="cs-sun" aria-hidden="true" src="https://csimg.nyc3.cdn.digitaloceanspaces.com/Icons%2Fsun.svg" decoding="async" alt="moon" width="15" height="15">
          </button> -->
      </div>
    </header>
    <!-- End of Header -->

    <div id="page-wrapper">      
      <!-- MAIN -->
      <main role="main">
        <!-- Content -->
        <article>
          <!-- <header class="section background-white">
            <div class="line text-center">        
              <h1 class="text-dark text-s-size-30 text-m-size-40 text-l-size-headline text-thin text-line-height-1">Gesture Recognition Technology is the Future.</h1>
              <p class="margin-bottom-0 text-size-16 text-dark">
              Try experimenting below with gesture recognition.<br>
              Below is a proof of concept of what we are creating. It can recognize poses, and teach you the sign language number system, 1 through 10.<br>
              So start interacting and learning sign language today!<br>
            </p>

            </div>
          </header> -->
          <div id="demo">
            <div class="container">
              <div class="hide-l hide-xl sm-12"> 
                <!-- TODO: Change to loading when libraries have not started... -->
                <button type="button" id="button" name="myButton">Start Your Camera<br />and<br />Start Learning ASL</button>
              </div>
              <div id="gesture_display" class="sm-12 m-4 l-2" style="background-color: grey; font-size: 3em; opacity: 0.5; margin: 50px; font-family: 'Inter,sans-serif'; position: absolute;">
                <div id="gesture-guide-title" style="opacity: 1;">Make the <span id="gesture-guide-name">0</span> Gesture</div>
                <!-- <div id="gesture-guide-percent" style="opacity: 1;"><span id="gesture-guide-percent">0</span>%</div> -->
                <div style="opacity: 1;"><img id="gesture-guide-image" src="img/asl-poses/ASL-Alphabet-0.png" alt="" style="width: 100%;"/></div>
              </div>
              <video style="display: none" class="input_video"></video>
              <!-- TODO: Make full screen -->
              <canvas class="output_canvas" style="display: block; width: 100%"></canvas>
            </div>
          </div>  
        </article>
      </main>
    </div>

    <!-- ============================================ -->
    <!--                  Footer                      -->
    <!-- ============================================ -->
  
    <footer id="footer-1147">
      <div class="cs-container">
          <div class="cs-top">
              <a aria-label="go back to home" class="cs-logo" href="">
                  <img class="cs-logo-img" loading="lazy" decoding="async" src="img/Gesture-G-Hand-Logo-With-Text.png" alt="logo" width="168" height="48">
              </a>
              <ul class="cs-ul">
                  <li class="cs-li">
                      <a href="#hero-1619" class="cs-link">Home</a>
                  </li>
                  <li class="cs-li">
                      <a href="#steps-889" class="cs-link">Our Process</a>
                  </li>
                  <li class="cs-li">
                      <a href="#services-1724" class="cs-link">About Us</a>
                  </li>
                  <li class="cs-li">
                      <a href="#services-1267" class="cs-link">Statistics</a>
                  </li>
                  <li class="cs-li">
                      <a href="#sbsr-1575" class="cs-link">FAQ</a>
                  </li>
                  <li class="cs-li">
                      <a href="#contact-984" class="cs-link">Contact Us</a>
                  </li>
              </ul>
          </div>
          <div class="cs-bottom">
              <!--Social-->
              <ul class="cs-social">
                  <li class="cs-social-li">
                      <a href="" class="cs-social-link" aria-label="facebook" target="_blank" rel="noopener">
                          <img class="cs-social-icon cs-default" src="https://csimg.nyc3.cdn.digitaloceanspaces.com/Icons/facebook-white.svg" alt="icon" loading="lazy" decoding="async" width="12" height="12" aria-hidden="true">
                      </a>
                  </li>
                  <li class="cs-social-li">
                      <a href="" class="cs-social-link" aria-label="twitter" target="_blank" rel="noopener">
                          <img class="cs-social-icon cs-default" src="https://csimg.nyc3.cdn.digitaloceanspaces.com/Icons/twitter-white.svg" alt="icon" loading="lazy" decoding="async" width="12" height="12" aria-hidden="true">
                      </a>
                  </li>
                  <li class="cs-social-li">
                      <a href="" class="cs-social-link" aria-label="instagram" target="_blank" rel="noopener">
                          <img class="cs-social-icon cs-default" src="https://csimg.nyc3.cdn.digitaloceanspaces.com/Icons/instagram-transparent.svg" alt="icon" loading="lazy" decoding="async" width="12" height="12" aria-hidden="true">
                      </a>
                  </li>
                  <li class="cs-social-li">
                      <a href="" class="cs-social-link" aria-label="twitter" target="_blank" rel="noopener">
                          <img class="cs-social-icon cs-default" src="https://csimg.nyc3.cdn.digitaloceanspaces.com/Icons/youtube-transparent2.svg" alt="icon" loading="lazy" decoding="async" width="12" height="12" aria-hidden="true">
                      </a>
                  </li>
              </ul>
              <span class="cs-copyright">
                  Â© Copyright <span id="cs-copyright-year">Year</span> 
                  - 
                  <a href="" class="cs-copyright-link">Gesture</a>
              </span>
          </div>
      </div>
      <!--Background-->
      <picture class="cs-background">
          <!--Mobile Image-->
          <source media="(max-width: 600px)" srcset="img/count-till-five-cropped-shot-of-hands-isolated.jpg">
          <!--Tablet and above Image-->
          <source media="(min-width: 601px)" srcset="img/count-till-five-cropped-shot-of-hands-isolated.jpg">
          <img loading="lazy" decoding="async" src="img/count-till-five-cropped-shot-of-hands-isolated.jpg" alt="kids" width="1280" height="568">
      </picture>
    </footer>
    <!-- End of Footer -->

    <script type="text/javascript" src="js/responsee.js"></script>
    <script type="text/javascript" src="js/jquery.events.touch.js"></script>
    <script type="text/javascript" src="owl-carousel/owl.carousel.js"></script>
    <script type="text/javascript" src="js/template-scripts.js"></script>
    <script type="text/javascript" src="https://kit.fontawesome.com/33a7a46513.js" crossorigin="anonymous"></script> 
    <script type="text/javascript">
      const module = {};
    </script>
    <script type="module">
    
      // TODO: move into it's own script.
      var query = window.location.search.substring(1);
      var qs = parse_query_string(query);
      
      var char_pointer = 0;
      var cur_char = qs.asl_chars[char_pointer]
      
      changeChar(cur_char, 0);
      
      let canvasElement = document.getElementsByClassName('output_canvas')[0];
      const canvasCtx = canvasElement.getContext('2d');
      
      
      // Commented out b/c we are making this better.
      if(mobileCheck() == false)
        startCamera();
      
      //required for mobile..
      window.addEventListener('load', function () {
        document.getElementById('button').onclick = function(){
          startCamera();
          
          //const stream = navigator.mediaDevices.getUserMedia({video: true});
          //const {width, height} = stream.getVideoTracks()[0].getSettings();
          //canvasElement.width = window.innerWidth;
          //canvasElement.height = window.innerHeight;
        };
      });

      function startCamera(){
        // TODO: Figure out if these values are correct for mobile compliance.
        const videoElement = document.getElementsByClassName('input_video')[0];
        const camera = new Camera(videoElement, {
          onFrame: async () => {
            await hands.send({image: videoElement});
          },
          width: 1280,
          height: 720
        });
        camera.start();
      }
      function onResults(results) {


        // Omg this is so effing baddd.... We need to have this load on page load..s
        
        
        canvasCtx.save();
        canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
        canvasCtx.drawImage(results.image, 0, 0, canvasElement.width, canvasElement.height);
        
        if (results.multiHandLandmarks) {
          for (const landmarks of results.multiHandLandmarks) {
            drawConnectors(canvasCtx, landmarks, HAND_CONNECTIONS,
                           {color: '#00FF00', lineWidth: 5});
            drawLandmarks(canvasCtx, landmarks, {color: '#FF0000', lineWidth: 2});
    
            let ar = []
            let ar2 = []
            let ar3 = []
            
            // TODO: Simplify.
            if(results.multiHandLandmarks[0] != undefined)
              for( var i = 0; i < results.multiHandLandmarks[0].length; i++){
                let x = results.multiHandLandmarks[0][i].x
                let y = results.multiHandLandmarks[0][i].y
                let z = results.multiHandLandmarks[0][i].z
                ar.push([x,y,z])
              }
            if(results.multiHandLandmarks[1] != undefined)
              for( var i = 0; i < results.multiHandLandmarks[1].length; i++){
                let x = results.multiHandLandmarks[1][i].x
                let y = results.multiHandLandmarks[1][i].y
                let z = results.multiHandLandmarks[1][i].z
                ar2.push([x,y,z])
              }
            if(results.multiHandLandmarks[2] != undefined)
              for( var i = 0; i < results.multiHandLandmarks[2].length; i++){
                let x = results.multiHandLandmarks[2][i].x
                let y = results.multiHandLandmarks[2][i].y
                let z = results.multiHandLandmarks[2][i].z
                ar3.push([x,y,z])
              }
            
            if(window.gesture != undefined){
              
              // TODO: Change to only execute once..
              //window.gesture.set_base_path_web();

              let gesture_reconition_output = window.gesture.predict({
                "right": JSON.stringify(ar),
                "left": JSON.stringify(ar2),
                "body": JSON.stringify(ar3)
              })
              
              if(isLikeGesture(window.static_gesture, cur_char)){
                char_pointer = ( char_pointer + 1 ) % qs.asl_chars.length;
                cur_char = qs.asl_chars[char_pointer]
                changeChar(cur_char, true)
              }
            }
          }
        }
        canvasCtx.restore();
      }
      
      const hands = new Hands({locateFile: (file) => {
        return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
      }});
      hands.setOptions({
        maxNumHands: 1,
        modelComplexity: 1,
        minDetectionConfidence: 0.5,
        minTrackingConfidence: 0.5
      });
      hands.onResults(onResults);
      
      function changeChar(cur_char, percent){
        window.cur_char = cur_char;
        document.getElementById("gesture-guide-name").innerHTML = cur_char;
        //document.getElementById("gesture-guide-percent").innerHTML = percent;
        document.getElementById("gesture-guide-image").setAttribute("src", "img/asl-poses/ASL-Alphabet-" + cur_char + ".png");
      }

      function parse_query_string(query) {
        var vars = query.split("&");
        var query_string = {};
        for (var i = 0; i < vars.length; i++) {
          var pair = vars[i].split("=");
          var key = decodeURIComponent(pair.shift());
          var value = decodeURIComponent(pair.join("="));
          // If first entry with this name
          if (typeof query_string[key] === "undefined") {
            query_string[key] = value;
            // If second entry with this name
          } else if (typeof query_string[key] === "string") {
            var arr = [query_string[key], value];
            query_string[key] = arr;
            // If third or later entry with this name
          } else {
            query_string[key].push(value);
          }
        }
        return query_string;
      }

      // We need a different type of comparison for a few edge cases... 
      // because some gestures are similar to others.
      function isLikeGesture(a, b){
        if(a == b)
          return true;
        // start with the numbers.
        console.log(a,b)
        if((a == 'O' || a == 'zero' || a === 0) && (b === "0") ){
          return true;
        }
        if((a == "D" || a == 'one' || a == 'one_inv') && (b === "1" || b == "D") ){
          return true;
        }
        if((a == "V" || a == 'two' || a == 'two_inv' || a == 2 ) && (b == 2 || b == "V")){
          return true;
        }
        if((a == 'three' || a == 'three_inv' || a == 3) && (b == 3) ){
          return true;
        }
        if((a == "B" || a == 'four' || a == 'four_inv' || a == 4 )&& (b == 4 || b == "B")){
          return true;
        }
        if((a == 'five'  || a == 'five_inv' || a == 5) && (b == 5) ){
          return true;
        }
        if((a == 'six' || a == 6) && (b == 6) ){
          return true;
        }
        if((a == 'seven' || a == 7 )&& (b == 7) ){
          return true;
        }
        if((a == 'eight' || a == 8) && (b == 8) ){
          return true;
        }
        if((a == 'nine' || a == 'F' || a == 9) && (b == 9 || b == "F") ){
          return true;
        }

        // This model needs some help.
        if(a == 'Q' && b == 'G')
          return true;

        return false;

      }
      function mobileCheck() {
        let check = false;
        (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
        return check;
      };
      </script>
  </body>
</html>